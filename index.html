<script>
    // Načtení dat při startu
    let balance = parseFloat(localStorage.getItem('laura_balance')) || 0;
    let history = JSON.parse(localStorage.getItem('laura_history')) || [];
    let goalPrice = parseFloat(localStorage.getItem('laura_goal_price')) || 0;
    let goalName = localStorage.getItem('laura_goal_name') || "Napiš si cíl...";

    function updateDisplay() {
        // Zobrazení zůstatku
        document.getElementById('balance').innerText = balance.toLocaleString() + " Kč";
        
        // Aktualizace cíle
        document.getElementById('goal-name').innerText = goalName;
        document.getElementById('goal-price').value = goalPrice > 0 ? goalPrice : '';
        document.getElementById('goal-input').value = (goalName !== "Napiš si cíl...") ? goalName : '';
        
        // Výpočet procent
        let percent = 0;
        if (goalPrice > 0) {
            percent = Math.floor((balance / goalPrice) * 100);
            if (percent < 0) percent = 0;
            if (percent > 100) percent = 100;
        }
        
        document.getElementById('progress-bar').style.width = percent + "%";
        document.getElementById('goal-percent').innerText = percent + "% splněno";

        // Výpis historie
        const list = document.getElementById('history-list');
        list.innerHTML = '';
        const recentHistory = history.slice(-5).reverse();
        recentHistory.forEach(item => {
            const div = document.createElement('div');
            div.className = 'history-item';
            const color = item.type === 'plus' ? 'green' : '#f44336';
            const sign = item.type === 'plus' ? '+' : '-';
            div.innerHTML = `<span>${item.note}</span><span style="color: ${color}">${sign}${item.amount} Kč</span>`;
            list.appendChild(div);
        });
    }

    function updateMoney(type) {
        const amountInput = document.getElementById('amount');
        const noteInput = document.getElementById('note');
        
        const amount = parseFloat(amountInput.value);
        const note = noteInput.value || (type === 'plus' ? 'Příjem' : 'Výdaj');

        if (isNaN(amount) || amount <= 0) {
            alert("Zadej prosím nějaké číslo.");
            return;
        }

        if (type === 'plus') {
            balance += amount;
        } else {
            balance -= amount;
        }

        // Uložit do historie
        history.push({ type, amount, note });
        
        // Uložit do paměti telefonu
        localStorage.setItem('laura_balance', balance);
        localStorage.setItem('laura_history', JSON.stringify(history));

        // Vymazat pole a překreslit
        amountInput.value = '';
        noteInput.value = '';
        updateDisplay();
    }

    function updateGoal() {
        goalPrice = parseFloat(document.getElementById('goal-price').value) || 0;
        goalName = document.getElementById('goal-input').value || "Napiš si cíl...";
        
        localStorage.setItem('laura_goal_price', goalPrice);
        localStorage.setItem('laura_goal_name', goalName);
        updateDisplay();
    }

    function resetAll() {
        if(confirm("Opravdu chceš vymazat celou kasičku?")) {
            localStorage.clear();
            location.reload();
        }
    }

    // První spuštění po načtení stránky
    window.onload = updateDisplay;
</script>
